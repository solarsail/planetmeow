Title: 向2^n上取整
Category: 技巧
Tags: c, tip

在代码中看到类似这样的语句：

    :::c
    int m = 1 << n - 1;
    int y = (x + m) & ~m;

这是在干啥？琢磨了一下，原来就是向$2^n$取整。

`1 << n - 1` 即 $2^n-1$ 是低位上的 $n$ 个1，如果直接与 `~m` 做按位与就是舍掉最低的 $n$ 位，相当于向 $2^n$ 下取整。而先加上 $m$，就保证了任何 $a\cdot 2^n<x\leq (a+1)\cdot 2^n$ 都能转换为 $(a+1)\cdot 2^n\leq x' < (a+2)\cdot 2^n$。再将 $x'$ 向 $2^n$ 下取整，实际上就是将 $x$ 向 $2^n$ 上取整。

类似的，`y = (x + m) >> n` 就是将 $x/2^n$ 的商向 $2^n$ 上取整。
